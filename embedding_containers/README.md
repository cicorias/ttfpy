# Purpose
This module:
* reads in metadata and stores it in a sqlite table named 'metadata'
* reads in images, computes embeddings via a pluggable docker container, and stores them in a sqlite table named 'embedding'
* computes the cosine similarities between all of the embeddings, and stores them in a sqlite table named 'comparison'
* generates a tsv report that is a join between metadata and comparisons:
    * each line of the report has the format: ```image_path1 image_path2 cosine_similarity```      
# Installation
* Create a virtualenv with >= python 3.5 (3.5 comes by default on ubuntu xenial):
    * ```python3 -m venv ENV```
* Activate virtualenv:
    * ```source ENV/bin/activate```
* Install dependencies:
    * ```pip3 install -r requirements-lock.txt```
    * Note - there are two requirements files. ```requirements.txt``` has all of the dependencies in a readable format, without versions specified. While normally the project would work if you installed all of the latest versions from this file, some dependencies may update in the future. Therefore, ```requirements-lock.txt``` contains versions of dependencies and subdependencies that will work, and is generated by running ```pip3 freeze > requirements-lock.txt``` from within the virtual environment once all of the dependencies have been installed. To be clear, at the time of writing this, ```requirements-lock.txt``` is generated by creating a virtual environment, running ```pip3 install -r requirements.txt```, and then running ```pip3 freeze > requirements-lock.txt```.
# Run
* Example:
    * ```python main.py --DB_CONNECTION sqlite:///sqlalchemy_example.db --XL_FILE_PATH metadata_embedding_explorer/metadata.xlsx --XL_SHEET_NAME Sheet1 --IMAGE_DIR_PATH C:\Users\miperel\Desktop\metadata\test_images_flat --CHUNK_SIZE 100 --ALGORITHM_CONTAINER facenet --SHOULD_COMPUTE_COMPARISON True --TSV_REPORT_FILE_PATH report.tsv```
# Development
* To check types:
    * ```mypy metadata_embedding_explorer --ignore-missing-imports```
* To check style:
    * ```pylint metadata_embedding_explorer```
* To autoformat the code:
    * ```./format.sh```